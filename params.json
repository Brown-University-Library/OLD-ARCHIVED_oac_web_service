{"body":"# Open Annotation plugin for Fedora\r\n\r\nThe Open Annotation plugin for Fedora is a content-agnostic web service that allows developers to create, query, retrieve, and serialize annotations using the Fedora Commons repository software to store annotations and their content.  The plugin is designed to implement the [Open Annotation Core Data Model](http://www.openannotation.org/spec/core/):\r\n\r\n> The Open Annotation Core Data Model specifies an interoperable framework for creating associations between related resources, annotations, using a methodology which conforms to the Architecture of the World Wide Web. Open Annotations can easily be shared between platforms, with sufficient richness of expression to satisfy complex requirements while remaining simple enough to also allow for the most common use cases, such as attaching a piece of text to a single web resource.\r\n\r\n> An Annotation is considered to be a set of connected resources, including a body and target, and conveys that the body is somehow about the target. The full model supports additional functionality, enabling semantic tagging, embedding content, selecting segments of resources, choosing the appropriate representation of a resource and providing styling hints for consuming clients.\r\n\r\n## This application consists of several components:\r\n\r\n#### A Jython web service that:\r\n\r\n* Creates annotation objects (default cmodel:oa-annotation) in Fedora [via HTTP POST].\r\n* Optionally, creates annotation bodies as new objects in Fedora.  Annotation bodies can also be URIs for existing resources on the web. [via HTTP POST]\r\n* Indexes the RDF content of annotations objects\r\n* Provides a SPARQL endpoint for searching and retrieving data from the annotation index [via HTTP GET or HTTP POST]\r\n* Serializes annotations and/or dumps the entire repository as RDF/XML, JSON, NT, TTL, or CSV [via HTTP GET]\r\n\r\n#### Fedora objects to support the use of the OA service:\r\n\r\n* Fedora content model (cmodel:oa-annotation) that includes the following datastreams:\r\n* Dublin Core\r\n* annotation (rdf/xml)\r\n* specifictarget (rdf/xml)\r\n* selector (rdf/xml)\r\n* Service Definition (SDef) and Service Definition (SDep) for serializing oa-annotation objects\r\n\r\n### Requirements\r\n\r\n* Instance of [Fedora Commons 3.5](https://wiki.duraspace.org/display/FEDORA35/Fedora+3.5+Documentation) running\r\n* Java Servlet container (tested on Tomcat 6/7) in which to install this plugin\r\n\r\n### Quick Start\r\n  ***Note: A full installation is recommended for a production system***\r\n\r\n* Download [this](https://github.com/downloads/Brown-University-Library/oac_web_service/oac_web_service.war) WAR file (version 0.9)\r\n* Deploy into your favorite Java Servlet container\r\n* Edit the `webapps/oac_web_service/fedora_settings.py` file and enter the following information:\r\n  * `FEDORA_HOST` : the host of your fedora installation, as accessed by the java servlet container  ie. http://localhost\r\n  * `FEDORA_PORT` : the port of your fedora installation, ie. 8080\r\n  * `FEDORA_USER` : the fedora username to connect as.  this user must have access to the API-M methods of the [REST API](https://wiki.duraspace.org/display/FEDORA35/REST+API)\r\n  * `FEDORA_PASS` : the password for the above user\r\n* Restart your Java Servlet container\r\n* See the API section below to test your installation\r\n\r\n### Full Installation Notes\r\n\r\n#### Persist local installation setting over updates\r\n\r\n* Copy the `webapps/oac_web_service/fedora_settings.py` file to somewhere outside of your Java Servlet's directory tree.\r\n**The user that runs your Java Servlet container will need read permissions on this new file**\r\n* Set an environmental variable named `FEDORA_SETTINGS` to point to the new `fedora_settings.py` file you just created.  For example, if using Tomcat on Linux, create or edit the `$CATALINA_HOME/bin/setenv.sh` file and add the following line:\r\n    `export FEDORA_SETTINGS=/the/location/of/your/new/fedora_settings.py`\r\n* Edit the `fedora_settings.py` file and enter the following information:\r\n  * `FEDORA_HOST` : the host of your fedora installation, as accessed by the java servlet container  ie. http://localhost\r\n  * `FEDORA_PORT` : the port of your fedora installation, ie. 8080\r\n  * `FEDORA_USER` : the fedora username to connect as.  this user must have access to the API-M methods of the [REST API](https://wiki.duraspace.org/display/FEDORA35/REST+API)\r\n  * `FEDORA_PASS` : the password for the above user\r\n\r\n#### Keep in sync with Fedora\r\n\r\nTo keep the Open Annotations index to stay in sync with Fedora, **only one** of the following two options needs to be done.\r\n\r\n1.) **Messaging**\r\n\r\n  Messaging will ensure that the Open Annotation index is always in sync with Fedora, but requires that your Fedora instance is sending update messages to a JMS broker.\r\n  * Edit the `webapps/oac_web_service/WEB-INF/web.xml` file and uncomment the `<listener>` tag at the bottom so it looks like:\r\n          ```<listener>\r\n              <listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>\r\n          </listener>```\r\n  * Edit the `webapps/oac_web_service/WEB-INF/spring/jms.xml` file and change the following:\r\n    * Set the `brokerURL` in `<amq:connectionFactory id=\"amq.connectionFactory\" brokerURL=\"\"/>`<br />\r\n        **The brokerURL defaults to 'tcp://localhost:61616', which is the default JMS broker in Fedora.**\r\n    * Set the `destination` in `<jms:listener destination=\"\" ref=\"consumer.messageListener\" />`<br />\r\n        **The `destination` is the topic that the OAC service will listen to.  This defaults to Fedora's default: `fedora.apim.update`.**\r\n\r\n2.) **Scheduled Job**\r\n\r\n  You will need to set up a scheduled job to run the following command:\r\n\r\n  ```bash\r\n  the command\r\n  ```\r\n\r\n### API\r\n\r\nThere are three main services the Open Annoatino plugin provides: Create, Serialize, and Query\r\n\r\n#### Create\r\n\r\n    A POST method that creates an Annotation (A-1) object\r\n    based on a number of parameters.\r\n\r\n    Required Parameters:\r\n      source_uri:             The URI for the whole target object\r\n      dc_title:               Dublin Core title associated with the annotation, \r\n                              i.e. \"dublin core title goes here\" \r\n      body_content:           Contents of the body (XML, text, json, etc.)\r\n          AND\r\n      body_mimetype:          Mimetype of the body_content\r\n          OR\r\n      body_uri:               URI pointing to the body of the annotation\r\n\r\n    Optional Parameters:\r\n      annotator:              A string representing a user ID (0 or more)\r\n                              ie. 'Charly'\r\n      generator:              A string representing what generated the annotation\r\n                              ie. 'Web Client'\r\n      oax_style_uri:          A URI for a XSLT stylesheet used to render the whole target object. (0 or 1)\r\n      oa_selector:            A string with the selector value(0 or 1)\r\n      oa_selector_type_uri:   Required if an oa_selector is passed in\r\n                              ie. oa:Fragment\r\n      fragment_type:          URI describing the oa_selector type  Optional and only used if\r\n                              an oa_selector is passed in.\r\n                              ie. 'http://www.w3.org/TR/xpath/'\r\n      body_content_model:     A string representing the body's content model\r\n                              ie. 'tei-annotation'\r\n\r\n  Example Python code to call service:\r\n\r\n\r\n    import base64\r\n    import urllib\r\n    import urllib2\r\n    post_url = \"http://your.url/oac_web_service/create\"\r\n    params = { \r\n        \"source_uri\"            : \"test:1\",\r\n        \"body_content\"          : \"<TEI><body>text body</body></TEI>\",\r\n        \"body_mimetype\"         : \"text/xml\",\r\n        \"dc_title\"              : \"Open Annotation Collaboration Annotation object (A-1)\",\r\n        \"oa_selector\"           : \"/for/example/an/xpath/statement\",\r\n        \"oa_selector_type_uri\"  : \"oa:Fragment\",\r\n        \"fragment_type\"         : \"http://www.w3.org/TR/xpath/\",\r\n        \"annotator\"             : \"Gilbert\",\r\n        \"generator\"             : \"Web Client\",\r\n        \"body_content_model\"    : \"bdr-cmodel:tei-annotation\"\r\n    }\r\n    encoded_data = urllib.urlencode( params )\r\n    request = urllib2.Request( post_url, encoded_data )\r\n    # Authenticate with Fedora credentials\r\n    username = \"your fedora user\"\r\n    password = \"your fedora password\"\r\n    base64_auth_string = base64.encodestring( '%s:%s' % (username, password) )[:-1]\r\n    request.add_header( \"Authorization\", \"Basic %s\" % base64_auth_string )\r\n    response = urllib2.urlopen( request )\r\n    print response.read()\r\n\r\n\r\n#### Serialize\r\n\r\n    A GET method that takes a comma seperated list of Annotation\r\n    (A-1) PIDs to serialize as the 'pid' parameter.\r\n\r\n    Required parameters:\r\n      pid:      Comma seperated list of PIDs to serialize.\r\n\r\n    Optional parameters:\r\n      format:   Format of the serialization output\r\n                Options:\r\n                  - rdf/xml or xml (default)\r\n                  - rdf/json or json\r\n                  - turtle or ttl\r\n                  - nt\r\n                  - n3\r\n\r\nExample Python code to call service:\r\n\r\n    import urllib\r\n    import urllib2\r\n    get_url = \"http://your.url/oac_web_service/show\"\r\n    params = { \r\n      \"pid\"     : \"test:9,test:166\",\r\n      \"format\"  : \"json\"\r\n    }\r\n    args = urllib.urlencode( params )\r\n    request = urllib2.Request( get_url + \"?\" + args)\r\n    response = urllib2.urlopen( request )\r\n    print response.read()\r\n\r\n#### Query\r\n\r\n    A POST or GET method to query the Open Annotations index with a SPARQL Query\r\n    This method has READ access to the Annotations index.\r\n\r\n    Required parameters:\r\n      query:      The SPARQL query to execute\r\n\r\nExample Python code to call service:\r\n\r\n    import urllib\r\n    import urllib2\r\n    get_url = \"http://your.url/oac_web_service/sparql\"\r\n    params = { \r\n      \"query\"     : \"SELECT * { ?s ?p ?o }\"\r\n    }\r\n    args = urllib.urlencode( params )\r\n    request = urllib2.Request( get_url + \"?\" + args)\r\n    response = urllib2.urlopen( request )\r\n    print response.read()\r\n\r\n### Demo\r\n\r\n### Authors and Contributors\r\n\r\n* Andrew Ashton (@andyashton): Primary Investigator\r\n* Kyle Wilcox (@kwilcox): Developer\r\n\r\nFunded by a grant from the Andrew W. Mellon Foundation, via the Open Annotation Collaboration.","note":"Don't delete this file! It's used internally to help with page regeneration.","google":"","name":"Open Annotation plugin for Fedora","tagline":"Funded by the Andrew W. Mellon Foundation"}